<!DOCTYPE html>
<html>
    <head>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Inter:wght@400;500;600&display=swap');

            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            body {
                font-family: 'Inter', sans-serif;
                padding: 20px;
                background: #1A1A1A;
                color: #FFFFFF;
            }

            .container {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .title {
                font-family: 'Creepster', cursive;
                font-size: 24px;
                text-align: center;
                color: #FF3333;
                text-shadow: 0 0 10px rgba(255, 51, 51, 0.5);
                margin-bottom: 10px;
            }

            .image-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .image-button {
                background: #2A2A2A;
                border: 2px solid #333333;
                border-radius: 8px;
                padding: 0;
                cursor: pointer;
                transition: all 0.3s ease;
                overflow: hidden;
                aspect-ratio: 1;
                position: relative;
            }

            .image-button:hover {
                transform: scale(1.05);
                border-color: #FF3333;
                box-shadow: 0 0 20px rgba(255, 51, 51, 0.3);
            }

            .image-button img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: all 0.3s ease;
            }

            .upload-container {
                background: #2A2A2A;
                border: 2px dashed #333333;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .upload-container:hover {
                border-color: #FF3333;
                background: #333333;
            }

            .upload-text {
                font-size: 14px;
                color: #999999;
                margin-bottom: 4px;
            }

            .upload-subtext {
                font-size: 12px;
                color: #666666;
            }

            #preview {
                max-width: 100%;
                max-height: 150px;
                border-radius: 4px;
                display: none;
                margin: 10px auto;
            }

            input[type="file"] {
                display: none;
            }

            .error-text {
                color: #FF3333;
                font-size: 12px;
                text-align: center;
                display: none;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1 class="title">Scare Your Teammates</h1>
            <div class="image-grid">
                <button class="image-button" onclick="sendImage('https://res.cloudinary.com/damqsjjsn/image/upload/v1744127788/scary1_s2ctcr.png')">
                    <img src="https://res.cloudinary.com/damqsjjsn/image/upload/v1744127788/scary1_s2ctcr.png" alt="Scary Image 1" onerror="handleImageError(this)">
                </button>
                <button class="image-button" onclick="sendImage('https://res.cloudinary.com/damqsjjsn/image/upload/v1744127788/scary2_d0hipi.webp')">
                    <img src="https://res.cloudinary.com/damqsjjsn/image/upload/v1744127788/scary2_d0hipi.webp" alt="Scary Image 2" onerror="handleImageError(this)">
                </button>
            </div>
            <p class="error-text" id="errorText">Error loading images. Please ensure images are in the plugin directory.</p>
            <div class="upload-container" id="dropZone">
                <p class="upload-text">Upload your own scary image</p>
                <p class="upload-subtext">PNG or JPG recommended</p>
                <img id="preview" alt="Preview">
                <input type="file" id="upload" accept="image/*">
            </div>
        </div>
        <script>
            let currentImageData = null;
            const upload = document.getElementById('upload');
            const preview = document.getElementById('preview');
            const dropZone = document.getElementById('dropZone');
            const errorText = document.getElementById('errorText');

            function handleImageError(img) {
                console.error('Failed to load image:', img.src);
                errorText.style.display = 'block';
                img.parentElement.style.opacity = '0.5';
            }

            function handleFile(file) {
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = () => {
                        preview.src = URL.createObjectURL(file);
                        preview.style.display = 'block';
                        currentImageData = reader.result;
                        parent.postMessage({
                            pluginMessage: {
                                type: 'show-image',
                                imageData: currentImageData
                            }
                        }, '*');
                    };
                    reader.readAsArrayBuffer(file);
                }
            }

            async function sendImage() {
                try {
                    const response = await fetch('https://res.cloudinary.com/demo/image/upload/v1312461204/sample.jpg');
                    if (!response.ok) {
                        throw new Error('Failed to fetch image');
                    }
                    
                    const buffer = await response.arrayBuffer();
                    const uint8Array = new Uint8Array(buffer);
                    
                    parent.postMessage({
                        pluginMessage: {
                            type: 'create-image',
                            imageData: uint8Array
                        }
                    }, '*');
                } catch (error) {
                    console.error('Error sending image:', error);
                    parent.postMessage({
                        pluginMessage: {
                            type: 'error',
                            message: error.message
                        }
                    }, '*');
                }
            }

            dropZone.onclick = () => upload.click();
            
            dropZone.ondragover = (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#FF3333';
            };
            
            dropZone.ondragleave = () => {
                dropZone.style.borderColor = '#333333';
            };
            
            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#333333';
                handleFile(e.dataTransfer.files[0]);
            };
            
            upload.onchange = (event) => {
                handleFile(event.target.files[0]);
            };
        </script>
    </body>
</html>
